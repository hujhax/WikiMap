<!DOCTYPE html><!--HTML5 doctype-->
<html>
<head>
	<title>WikiMap - MediaWiki Testing Doc</title>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="./js/underscore-min.js"></script>

	<script>
		function wikipediaCallAPI(preString, postString, callback) {
			var searchString = document.getElementById("testData").value;
			var URL = preString + searchString + postString;

			$.getJSON(URL, function (data) {
				console.log(data);
				callback(data);
			});
		}

		function wikipediaAccumulator(preString, postString, callback) {
			var searchString = document.getElementById("testData").value;
			var URL = preString + searchString + postString + "&callback=?&";

			$.getJSON(URL + "continue=", _.partial(wikipediaAccumulatorCore, URL, callback, []));
		}

		function wikipediaAccumulatorCore(URL, callback, results, data) {
			results.push(data);
			if (data.continue)
				$.getJSON(URL + $.param(data.continue), _.partial(wikipediaAccumulatorCore, URL, callback, results));
			else
				callback(results);
		}

		function wikipediaSearch() {
			return wikipediaCallAPI("http://en.wikipedia.org/w/api.php?action=opensearch&search=", "&limit=10&namespace=0&format=json", wikipediaSearchShow);
		}

		function wikipediaSearchShow(data) {
			document.getElementById("testMessage").innerHTML = data[1].join("<br>");
		}

		function wikipediaLinks() {
			return wikipediaAccumulator("http://en.wikipedia.org/w/api.php?format=json&action=query&titles=", "&redirects&prop=links", wikipediaLinksShow);
		}

		function wikipediaLinksShow(results) {
			var titleArray = _.chain(results)
								.pluck("query")
								.pluck("pages")
								.map(function(array) {
									return _.chain(array)
												.flatten()
												.first()
												.value();
											})
								.pluck("links")
								.flatten()
								.pluck("title")
								.value();

			document.getElementById("testMessage").innerHTML = titleArray.join("<br>");
		}

		function wikipediaPage() {
			return wikipediaCallAPI("http://en.wikipedia.org/w/api.php?action=parse&format=json&page=", "&redirects&prop=text", wikipediaPageShow);
		}

		function wikipediaPageShow(data) {
			document.getElementById("testMessage").innerHTML = data.parse.text["*"];
		}
	</script>
</head>

<body>
	<input id="testData" value="Kitten"/>
	<button onclick="wikipediaSearch()">Search Wikipedia</Button>
	<button onclick="wikipediaLinks()">Get Links</Button>
	<button onclick="wikipediaPage()">Get Page</Button>
	<div id="testMessage"></div>
</body>
</html>